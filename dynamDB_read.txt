import json
import boto3

dynamodb = boto3.resource('dynamodb')
table_name = 'vdirken'
table = dynamodb.Table(table_name)

def lambda_handler(event, context):
    try:
        # Retrieve the item ID to read from the query parameters
        # message_id = event.get('messageID_lambda') uses the get method to retrieve the value of messageID_lambda 
        # from the event object. 
        # If the key does not exist, it will return None instead of raising an exception.
        
        message_id = event.get('messageID_lambda')

        # If an ID is provided, read the specific item
        if message_id:
            response = table.get_item(Key={'messageID': message_id})
            if 'Item' in response:
                item = response['Item']
                return {
                    'statusCode': 200,
                    'body': json.dumps({'message': 'Item retrieved successfully', 'item': item})
                }
            else:
                return {
                    'statusCode': 404,
                    'body': json.dumps({'message': 'Item not found'})
                }
        else:
            # Retrieve all items from the DynamoDB table
            response = table.scan()
            if 'Items' in response:
                items = response['Items']
                return {
                    'statusCode': 200,
                    'body': json.dumps({'message': 'Items retrieved successfully', 'items': items})
                }
            else:
                return {
                    'statusCode': 404,
                    'body': json.dumps({'message': 'No items found'})
                }
    except Exception as e:
        return {
            'statusCode': 500,
            'body': json.dumps({'message': 'An error occurred', 'error': str(e)})
        }